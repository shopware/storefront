"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["plugin_forms_form-country-state-select_plugin_js"],{6300:(t,e,i)=>{i.r(e),i.d(e,{default:()=>s});var r=i(9568),n=i(4049),o=i(3107);class s extends r.Z{init(){this.initClient(),this.initSelects()}initClient(){this._client=new o.Z}initSelects(){let{countrySelectSelector:t,countryStateSelectSelector:e,initialCountryAttribute:i,initialCountryStateAttribute:r}=s.options,o=n.Z.querySelector(this.el,t),u=n.Z.querySelector(this.el,e),d=n.Z.getDataAttribute(o,i),a=n.Z.getDataAttribute(u,r),l=o.options[o.selectedIndex],c=!!n.Z.getDataAttribute(l,this.options.vatIdRequired,!1),p=document.querySelector(this.options.vatIdFieldInput),h=!!n.Z.getDataAttribute(l,this.options.stateRequired,!1),q=n.Z.querySelector(document,this.options.zipcodeLabel,!1),b=n.Z.querySelector(document,this.options.zipcodeFieldInput,!1),_=!!n.Z.getDataAttribute(l,this.options.zipcodeRequired,!1);o.addEventListener("change",this.onChangeCountry.bind(this)),d&&(this.requestStateData(d,a,h),_&&this._updateZipcodeRequired(q,b,_),p&&this._updateRequiredVatId(p,c))}onChangeCountry(t){let e=t.target.value,i=t.target.options[t.target.selectedIndex],r=!!n.Z.getDataAttribute(i,this.options.stateRequired);this.requestStateData(e,null,r);let o=n.Z.getDataAttribute(i,this.options.vatIdRequired),s=document.querySelector(this.options.vatIdFieldInput),u=n.Z.querySelector(document,this.options.zipcodeLabel,!1),d=n.Z.querySelector(document,this.options.zipcodeFieldInput,!1),a=!!n.Z.getDataAttribute(i,this.options.zipcodeRequired,!1);this._updateZipcodeRequired(u,d,a),s&&this._updateRequiredVatId(s,o)}requestStateData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=JSON.stringify({countryId:t});this._client.post(window.router["frontend.country.country-data"],r,t=>{let r=JSON.parse(t);!function(t,e,i,r){let{stateRequired:o,states:s}=t,{countryStateSelectSelector:u,countryStatePlaceholderSelector:d}=r,a=n.Z.querySelector(i,u);(function(t,e){t.querySelectorAll(e).forEach(t=>t.remove())})(a,"option:not(".concat(d,")")),function(t,e,i){if(0===e.length){t.parentNode.classList.add("d-none"),t.setAttribute("disabled","disabled");return}e.map(t=>(function(t,e){let i=document.createElement("option");return i.setAttribute("value",t.id),i.innerText=t.translated.name,t.id===e&&i.setAttribute("selected","selected"),i})(t,i)).forEach(e=>{t.append(e)}),t.parentNode.classList.remove("d-none"),t.removeAttribute("disabled")}(a,s,e),function(t,e,i){let r=t.querySelector(i),n=t.parentNode.querySelector("label");if(e){r.setAttribute("disabled","disabled"),t.setAttribute("required","required"),n.textContent&&"*"!==n.textContent.substr(-1,1)&&(n.textContent="".concat(n.textContent.trim(),"*"));return}n.textContent&&"*"===n.textContent.substr(-1,1)&&(n.textContent=n.textContent.substr(0,n.textContent.length-1)),r.removeAttribute("disabled"),t.removeAttribute("required")}(a,o,"option".concat(d))}(r={...r,stateRequired:i},e,this.el,s.options)})}_updateRequiredVatId(t,e){let i=t.parentNode.querySelector("label");if(e){t.setAttribute("required","required"),"*"!==i.textContent.substr(-1,1)&&(i.textContent="".concat(i.textContent,"*"));return}"*"===i.textContent.substr(-1,1)&&(i.textContent=i.textContent.substr(0,i.textContent.length-1)),t.removeAttribute("required")}_updateZipcodeRequired(t,e,i){if(t&&e){if(t.className=i?"":"d-none",i){e.setAttribute("required","required");return}e.removeAttribute("required")}}}s.options={countrySelectSelector:".country-select",initialCountryAttribute:"initial-country-id",countryStateSelectSelector:".country-state-select",initialCountryStateAttribute:"initial-country-state-id",countryStatePlaceholderSelector:'[data-placeholder-option="true"]',vatIdFieldInput:"#vatIds",zipcodeFieldInput:'[data-input-name="zipcodeInput"]',vatIdRequired:"vat-id-required",stateRequired:"state-required",zipcodeRequired:"zipcode-required",zipcodeLabel:"#zipcodeLabel"}},3107:(t,e,i)=>{i.d(e,{Z:()=>r});class r{get(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",r=this._createPreparedRequest("GET",t,i);return this._sendRequest(r,null,e)}post(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(e,r);let n=this._createPreparedRequest("POST",t,r);return this._sendRequest(n,e,i)}delete(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(e,r);let n=this._createPreparedRequest("DELETE",t,r);return this._sendRequest(n,e,i)}patch(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(e,r);let n=this._createPreparedRequest("PATCH",t,r);return this._sendRequest(n,e,i)}abort(){if(this._request)return this._request.abort()}_registerOnLoaded(t,e){e&&t.addEventListener("loadend",()=>{e(t.responseText,t)})}_sendRequest(t,e,i){return this._registerOnLoaded(t,i),t.send(e),t}_getContentType(t,e){return t instanceof FormData&&(e=!1),e}_createPreparedRequest(t,e,i){return this._request=new XMLHttpRequest,this._request.open(t,e),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),i&&this._request.setRequestHeader("Content-type",i),this._request}constructor(){this._request=null}}}}]);